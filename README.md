# NOTIFY-ONLINE-SERVICE

**NOTIFY-ONLINE-SERVICE** является микросервисом рассылки онлайн-уведомлений для пользователей CyberWay.
Также хранит в себе настройки рассылки. Предполагается что существует микросервис регистрации событий, который
оповещает этот микросервис о новых событиях, оставляя право фильтрации и непосредственной рассылки уже этому микросервису.

### API

```
subscribe:                 // Подписаться на рассылку эвентов
    user <string>          // Имя пользователя
    app <string>('cyber')  // Тип приложения
        [
          cyber            // CyberWay
        | gls              // Golos
        ]
    channelId <string>     // Идентификатор канала

unsubscribe:               // Отписаться от рассылки эвентов
    user <string>          // Имя пользователя
    app <string>('cyber')  // Тип приложения
        [
          cyber            // CyberWay
        | gls              // Golos
        ]
    channelId <string>     // Идентификатор канала

unsubscribeByChannel:
    channelId <string>     // Идентификатор канала

getOptions:                // Получить настройки пользователя
    user <string>          // Имя пользователя
    app <string>('cyber')  // Тип приложения
        [
          cyber            // CyberWay
        | gls              // Golos
        ]

setOptions:                              // Установить настройки пользователя
    user <string>                        // Имя пользователя
    app <string>('cyber')                // Тип приложения
        [
          cyber                          // CyberWay
        | gls                            // Golos
        ]
    data:                                // Устанавливаемые настройки
        show:                            // Показывать ли указанные типы нотификаций
            upvote <boolean>             // лайк (голос)
            downvote <boolean>           // флаг (дизлайк, жалоба)
            transfer <boolean>           // перевод средств
            reply <boolean>              // ответ на пост или комментарий
            subscribe <boolean>          // подписка на блог
            unsubscribe <boolean>        // отписка от блога
            mention <boolean>            // упоминание в посте, заголовке поста или в комменте (через @)
            repost <boolean>             // репост
            reward <boolean>             // награда пользователю
            curatorReward <boolean>      // награда куратору
            witnessVote <boolean>        // голос за делегата
            witnessCancelVote <boolean>  // отмена голоса за делегата

transfer:                         // Переслать данные пользователю
    message <object>              // Объект сообщения из сервиса нотификаций

history:                          // Получение истории эвентов относительно настроек
    user <string>                 // Имя пользователя
    app <string>('cyber')         // Тип приложения
        [
          cyber                   // CyberWay
        | gls                     // Golos
        ]
    fromId <string|null>(null)    // Идентификатор с которого начать
    limit <number>(10)            // Количество записей
    markAsViewed <boolean>(true)  // Пометить ли их прочитанными
    freshOnly <boolean>(false)    // Вывести ли только не прочитанные

historyFresh:                     // Получение количества непрочитанных эвентов относительно настроек
    user <string>                 // Имя пользователя
    app <string>('cyber')         // Тип приложения
        [
          cyber                   // CyberWay
        | gls                     // Golos
        ]
```

### Переменные окружения

Возможные переменные окружения `ENV`:

-   `GLS_FACADE_CONNECT` _(обязательно)_ - адрес подключения к микросервису фасаду.

-   `GLS_NOTIFY_CONNECT` _(обязательно)_ - адрес подключения к микросервису нотификаций.

-   `GLS_CONNECTOR_HOST` _(обязательно)_ - адрес, который будет использован для входящих подключений связи микросервисов.  
    Дефолтное значение при запуске без докера - `0.0.0.0`

-   `GLS_CONNECTOR_PORT` _(обязательно)_ - адрес порта, который будет использован для входящих подключений связи микросервисов.  
    Дефолтное значение при запуске без докера - `3000`

-   `GLS_METRICS_HOST` _(обязательно)_ - адрес хоста для метрик.  
    Дефолтное значение при запуске без докера - `0.0.0.0`

-   `GLS_METRICS_PORT` _(обязательно)_ - адрес порта для метрик.  
    Дефолтное значение при запуске без докера - `9777`

-   `GLS_MONGO_CONNECT` - строка подключения к базе MongoDB.  
    Дефолтное значение - `mongodb://mongo/admin`

-   `GLS_DAY_START` - время начала нового дня в часах относительно UTC.  
    Дефолтное значение - `3` (день начинается в 00:00 по Москве).

### Запуск

Для запуска достаточно вызвать команду `docker-compose up` в корне проекта, предварительно указав необходимые `ENV` переменные.
